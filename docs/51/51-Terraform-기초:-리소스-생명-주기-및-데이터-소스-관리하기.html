
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>Terraform 기초: 리소스 생명 주기 및 데이터 소스 관리하기</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">Terraform 기초: 리소스 생명 주기 및 데이터 소스 관리하기</h2>
                                <div class="box-info">
                                    <p class="category">탐구 생활/Terraform</p>
                                    <p class="date">2024-11-22 19:47:31</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <h3 data-ke-size="size23"><b>1. 리소스 생명 주기 (Lifecycle Rules)</b></h3>
<p data-ke-size="size16">Terraform은 리소스를 업데이트할 때 기존 리소스를 삭제(destroy)하고 새로운 리소스를 생성(create)하는 <b>immutable 인프라</b> 접근 방식을 따릅니다. 그러나 모든 경우에 이러한 동작이 적합하지 않을 수 있습니다. 이를 제어하려면 <b>lifecycle rules</b>를 활용할 수 있습니다.</p>
<h4 data-ke-size="size20"><b>1.1 <code>create_before_destroy</code></b></h4>
<p data-ke-size="size16">기존 리소스를 삭제하기 전에 새로운 리소스를 먼저 생성한다. 어떤 리소스는 다운 타임을 최소화하기 위해 이러한 조치가 필요할 것이다.</p>
<pre class="nginx"><code>resource "aws_instance" "example" {
  ami           = "ami-123456"
  instance_type = "t2.micro"

  lifecycle {
    create_before_destroy = true
  }
}</code></pre>
<h4 data-ke-size="size20"><b>1.2 <code>prevent_destroy</code></b></h4>
<p data-ke-size="size16">리소스가 삭제되지 않도록 보호한다, 이때 보호되는것은 변경에 의한 삭제이지 main.tf 등 문서에서 리소스가 사라졌을때 삭제되는 것까지지 방지하는것은 아니다.</p>
<pre class="nginx"><code>resource "aws_s3_bucket" "example" {
  bucket = "example-bucket"

  lifecycle {
    prevent_destroy = true
  }
}</code></pre>
<h4 data-ke-size="size20"><b>1.3. <code>ignore_changes</code></b></h4>
<p data-ke-size="size16">특정 속성 변경을 무시한다. 예를 들어, 태그 변경을 Terraform에서 무시하도록 설정할 수 있다.</p>
<pre class="nginx"><code>resource "aws_instance" "web" {
  ami           = "ami-123456"
  instance_type = "t2.micro"

  lifecycle {
    ignore_changes = [
      tags
    ]
  }
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">주로 외부 시스템이나 사용자에 의해 변경될 수 있는 속성을 terraform 이 덮어쓰지 않도록 할 때 유용하다.</p>
<p data-ke-size="size16">- 위의 예시처럼 EC2 인스턴스의 태그나</p>
<p data-ke-size="size16">- S3 의 ACL 처럼 시스템이나 사용자에 의해 변경될 수 있는 것들</p>
<p data-ke-size="size16">- 테스트 환경에서 의도적으로 속성을 변경하려고 할때</p>
<p data-ke-size="size16">&nbsp;</p>
<p style="color: #000000; text-align: start;" data-ke-size="size16"><b>ignore_changes</b> 가 유용하지만 Terraform 이 바라보는 상태와 실제 인프라의 상태가 달라지게 되므로 나중에 둘을 동기화할때 추가작업이 필요해진다. 따라서 신중히 사용해야한다.</p>
<hr data-ke-style="style1" />
<h3 data-ke-size="size23"><b>2. Meta Arguments: Count</b></h3>
<p data-ke-size="size16">Terraform에서 동일한 리소스를 여러 개 생성하려면 <code>count</code> 메타 인수를 사용한다.</p>
<h4 data-ke-size="size20"><b>2.1 기본 사용법</b></h4>
<p data-ke-size="size16">다음은 로컬 파일을 3개 생성하는 예제이다.</p>
<pre class="nix"><code>resource "local_file" "example" {
  count    = 3
  filename = "/root/file-${count.index}.txt"
  content  = "This is file ${count.index}"
}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">이렇게 하면 <code>/root/file-0.txt</code>, <code>/root/file-1.txt</code>, <code>/root/file-2.txt</code>가 생성된다.</p>
<h4 data-ke-size="size20"><b>2.2 Count와 리스트</b></h4>
<p data-ke-size="size16">동적 파일 이름을 사용하려면 리스트 변수를 활용할 수 있다.</p>
<pre class="routeros"><code>variable "filenames" {
  default = ["file-a.txt", "file-b.txt", "file-c.txt"]
}

resource "local_file" "example" {
  count    = length(var.filenames)
  filename = "/root/${var.filenames[count.index]}"
  content  = "This is ${var.filenames[count.index]}"
}</code></pre>
<p data-ke-size="size16">리스트 길이가 변경되면 자동으로 리소스 개수가 조정된다.</p>
<hr data-ke-style="style1" />
<h3 data-ke-size="size23"><b>3. Data Sources</b></h3>
<p data-ke-size="size16">Terraform은 <b>외부에서 생성된 리소스</b>를 읽고 활용하기 위해 <b>Data Sources</b>를 사용한다. 이때 외부라 하면 현재 terraform 파일에서 관리되지 않는 것을 총칭한다. 외부 클라우드에서 제공되는 데이터 소스일 수도 있으며, 내가 작업중인 컴퓨터의 다른 파일일 수도 있겠다.</p>
<h4 data-ke-size="size20"><b>3.1 기본 사용법</b></h4>
<p data-ke-size="size16">다음은 로컬 파일의 내용을 읽는 예시이다. example.txt 의 내용을 읽어서 new_example.txt 에 넣는다.</p>
<pre class="bash" data-ke-language="bash"><code>data "local_file" "example" {
  filename = "/root/example.txt"
}

resource "local_file" "new_file" {
  filename = "/root/new_example.txt"
  content  = data.local_file.example.content
}</code></pre>
<h4 data-ke-size="size20"><b>3.2 Data Sources vs Managed Resources</b></h4>
<table data-ke-align="alignLeft" data-ke-style="style12">
<thead>
<tr>
<th><b>Managed Resources</b></th>
<th><b>Data Sources</b></th>
</tr>
</thead>
<tbody>
<tr>
<td>Terraform에서 리소스를 생성, 업데이트, 삭제</td>
<td>외부 리소스에서 데이터만 읽기</td>
</tr>
<tr>
<td><code>resource</code> 키워드를 사용</td>
<td><code>data</code> 키워드를 사용</td>
</tr>
<tr>
<td>Terraform이 리소스의 상태를 관리</td>
<td>Terraform 외부의 리소스를 참조</td>
</tr>
</tbody>
</table>
<p data-ke-size="size16">&nbsp;</p>
<hr data-ke-style="style1" />
<p data-ke-size="size16">위의 내용을 활용하여 Terraform을 더욱 효율적으로 관리해보자! ?</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #Terraform #오블완 #티스토리챌린지 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
