
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>Kubernetes 기본구조</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">Kubernetes 기본구조</h2>
                                <div class="box-info">
                                    <p class="category">기초 지식/K8s</p>
                                    <p class="date">2024-11-20 20:40:16</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p><figure class="imageblock alignCenter" width="350" height="350" >
    <span data-lightbox="lightbox">
        <img src="./img/K8s_docker_support_MSA.webp" width="350" height="350"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<h3 id="1.-Kbuernetes(K8s)-란?" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1" data-ke-size="size23"><b>1. Kbuernetes(K8s) 란?</b><span><span data-vc="icon-undefined"></span></span></h3>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="24" data-ke-size="size16">MSA에서는 각 서비스가 컨테이너로 패키징되며, 하나의 서비스에 대해 N개의 컨테이너가 존재할 수 있습니다. 수십 개의 서비스만 있어도 수백 개 이상의 컨테이너를 관리해야 합니다.</p>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="126" data-ke-size="size16">컨테이너 관리에는 다음과 같은 요구 사항이 있습니다:</p>
<ul style="list-style-type: disc; background-color: #ffffff; color: #172b4d; text-align: start;" data-indent-level="1" data-ke-list-type="disc">
<li>다수의 서버를 하나의 클러스터처럼 사용.</li>
<li>여러 서버에 컨테이너를 배포.</li>
<li>서비스 디스커버리로 서비스 간 연결.</li>
<li>부하에 따른 자동 <b>스케일링(scale-out, scale-in)</b>.</li>
<li>장애 시 컨테이너 재생성과 트래픽 재연결.</li>
<li>서버 상태(헬스 체크) 모니터링.</li>
<li>스토리지 및 네트워크 관리.</li>
</ul>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="337" data-ke-size="size16">이러한 복잡성을 사람이 수동으로 처리하는 것은 비효율적이며, 이를 자동화하기 위해 <b>컨테이너 오케스트레이션</b>이 필요합니다. Kubernetes(K8s)는 이러한 요구를 충족시키는 대표적인 오케스트레이션 도구로, 대규모 컨테이너 관리와 자동화를 지원합니다.</p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style2" />
<h3 id="2-K8s-의-철학" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="482" data-ke-size="size23"><b>2. K8s 의 철학</b><span><span data-vc="icon-undefined"></span></span></h3>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="494" data-ke-size="size16">K8s 는 다음과 같은 철학에 기초하여 설계, 구현되었습니다.</p>
<ul style="list-style-type: disc; background-color: #ffffff; color: #172b4d; text-align: start;" data-indent-level="1" data-ke-list-type="disc">
<li>Immutable Infrastructure
<ul style="list-style-type: circle;" data-indent-level="2" data-ke-list-type="circle">
<li>클라우드 환경에서는 컴퓨터 리소스는 자유롭게 생성, 폐기, 확장할 수 있다. 따라서 인프라에 변경이 생기면 기존 인프라에 변경 사항을 적용하는게 아니라 기존 인프라를 파기하고 다시 만들도록 동작한다.</li>
</ul>
</li>
<li>Declarative Configuration
<ul style="list-style-type: circle;" data-indent-level="2" data-ke-list-type="circle">
<li>K8s 관리자는 인프라가 원하는 상태(Desired State)에 도달하기 위해 필요한 모든 과정을 선언적으로 명시해야한다.</li>
</ul>
</li>
<li>Self Healing
<ul style="list-style-type: circle;" data-indent-level="2" data-ke-list-type="circle">
<li>K8s 는 실시간으로 클러스터의 현재 상태(Current State) 를 바라보면서 Desired State 와 차이가 발생하면 이를 자동으로 복구한다.</li>
</ul>
</li>
</ul>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style2" />
<h3 id="3-K8s-의-구조" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="891" data-ke-size="size23"><b>3. K8s 의 구조</b><span><span data-vc="icon-undefined"></span></span></h3>
<h4 id="3.1-구조-개괄" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="903" data-ke-size="size20"><b>3.1 구조 개괄</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="914" data-ke-size="size16">K8s 의 구조를 단순하게 보면 <b>&ldquo;Master에 API 서버와 상태 저장소(etcd)를 두고 어플리케이션은 노드의 포드(pod) 에 배포되며, Master 가 각 노드의 에이전트(kubelet)와 통신하는 구조&rdquo;</b> 입니다.</p>
<p><figure class="imageblock alignCenter" width="650" height="205" >
    <span data-lightbox="lightbox">
        <img src="./img/K8s구조-개괄.png" width="650" height="205"  />
    </span>
    <figcaption>K8s 구조 개괄</figcaption>
</figure></p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style2" />
<h4 id="3.2-마스터" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1043" data-ke-size="size20"><b>3.2 마스터</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1052" data-ke-size="size16">K8s 의 마스터는 클러스터를 관리하는 역할을 합니다. 즉 노드들의 상태를 파악하고 어떤 컨테이너를 어떤 노드에서 가동할지 선택합니다. 이때 분산 저장소에 클러스터의 정보를 저장하고 조회하게 됩니다. 이러한 기능을 위해 각각의 노들들은 상호 직접적으로 소통하는게 아니라 오로지 마스터를 통해서만 소통이 가능하게 됩니다.</p>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1232" data-ke-size="size16">이러한 마스터의 주요 구성 요소로는 API Server, Scheduler, Controller Manager, etcd 가 있습니다.</p>
<p><figure class="imageblock alignCenter" width="650" height="303" >
    <span data-lightbox="lightbox">
        <img src="./img/K8s구조-마스터.png" width="650" height="303"  />
    </span>
    <figcaption>K8s master</figcaption>
</figure></p>
<p data-ke-size="size16">&nbsp;</p>
<h4 id="3.2.1-API-Server" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1312" data-ke-size="size20"><b>3.2.1 API Server</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1330" data-ke-size="size16">모든 요청을 처리하는 마스터의 핵심 구성 요소입니다. 검증된 K8s 관리자, 노드의 요청만 처리해야 하므로 인증 및 인가 기능을 갖추고 있습니다.</p>
<h4 id="3.2.2-Scheduler" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1415" data-ke-size="size20"><b>3.2.2 Scheduler</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1432" data-ke-size="size16">pod(컨테이너) 가 어떤 노드에서 가동할지 결정하는 구성 요소입니다.</p>
<h4 id="3.2.3-Controller-Manager" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1475" data-ke-size="size20"><b>3.2.3 Controller Manager</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1501" data-ke-size="size16">K8s 클러스터의 상태를 실시간으로 검사하면서 Current State 와 Desired State 를 비교하고 Desired State 가 되도록 유지합니다.</p>
<h4 id="3.2.4-etcd" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1594" data-ke-size="size20"><b>3.2.4 etcd</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1606" data-ke-size="size16">분산 key-value 저장소로 클러스터의 모든 설정, 상태 데이터를 저장합니다. Scheduler, Controlelr Manager 는 API Server 를 통해 etcd 에서 클러스터의 정보를 조회하고 갱신합니다.</p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style2" />
<h4 id="3.3-노드(node)" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1732" data-ke-size="size20"><b>3.3 노드(node)</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1746" data-ke-size="size16">노드는 pod(컨테이너) 가 직접적으로 가동되는 서버입니다. 다수의 노드로 클러스터를 구성합니다. 하나의 노드도 다양한 구성요소가 존재하는데 대표적인것은 kubelet 과 Kube proxy , 그리고 pod 입니다.</p>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1746" data-ke-size="size16">&nbsp;</p>
<p><figure class="imageblock alignCenter" width="650" height="357" >
    <span data-lightbox="lightbox">
        <img src="./img/K8s구조-노드.png" width="650" height="357"  />
    </span>
    <figcaption>K8s 노드</figcaption>
</figure></p>
<h4 id="3.3.1-kubelet" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1872" data-ke-size="size20"><b>3.3.1 kubelet</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1887" data-ke-size="size16">실제로 마스터의 요청을 받아 pod(컨테이너) 를 생성하는 주체입니다.</p>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1928" data-ke-size="size16">pod(컨테이너) 의 상태를 감시하는 역할도 수행하여 pod 의 상태를 API Server 로 전송합니다.</p>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1989" data-ke-size="size16">&nbsp;</p>
<h4 id="3.3.2-Kube-proxy" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="1991" data-ke-size="size20"><b>3.3.2 Kube proxy</b><span><span data-vc="icon-undefined"></span></span></h4>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2009" data-ke-size="size16">각 노드에서 실행되는 네트워크 프록시입니다. 노드의 네트워크 규칙을 유지 관리하고 내부 네트워크 세션이나 클러스터 바깥에서 컨테이너로 네트워크 통신을 할 수 있도록 해줍니다.</p>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2108" data-ke-size="size16">&nbsp;</p>
<h4 id="3.3.3-pod" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2110" data-ke-size="size20"><b>3.3.3 pod</b></h4>
<p><figure class="imageblock alignCenter" width="350" height="239" >
    <span data-lightbox="lightbox">
        <img src="./img/_K8s구조-pod.png" width="350" height="239"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">K8s 에서 배포할 수 있는 가장 작은 단위로, K8s 의 Object 들 중 하나입니다.</p>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2176" data-ke-size="size16">pod 는 하나 이상의 컨테이너와 스토리지 그리고 네트워크 속성 가지고 있으며, 컨테이너와 스토리지는 네트워크를 공유하며 상호 localhost 로 접근할 수 있습니다.</p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style2" />
<h3 id="4.-K8s-의-Object-들" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2275" data-ke-size="size23"><b>4. K8s 의 Object 들</b><span><span data-vc="icon-undefined"></span></span></h3>
<p style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2294" data-ke-size="size16">K8s 에는 대규모 분산환경에 필요한 요소들이 추상화 되어 있고 이러한 요소들을 Object 라고 부릅니다.</p>
<h4 id="4.1-어플리케이션-배포에-관한-Object-들" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2356" data-ke-size="size20"><b>4.1 어플리케이션 배포에 관한 Object 들</b><span><span data-vc="icon-undefined"></span></span></h4>
<ul style="list-style-type: disc; background-color: #ffffff; color: #172b4d; text-align: start;" data-indent-level="1" data-ke-list-type="disc">
<li>pod</li>
<li>(pod) ReplicaSet
<ul style="list-style-type: circle;" data-indent-level="2" data-ke-list-type="circle">
<li>pod 여러개를 복제하여 관리하는 Object</li>
</ul>
</li>
<li>Deployment
<ul style="list-style-type: circle;" data-indent-level="2" data-ke-list-type="circle">
<li>K8s 에서 실제 배포를 진행하는 기본 단위로 배포 전략 선택, 배포 Revision, Roll Back 등의 기능을 사용하려면 이 Objet 를 이용해야한다.</li>
</ul>
</li>
<li>DaemonSet
<ul style="list-style-type: circle;" data-indent-level="2" data-ke-list-type="circle">
<li>클러스터 전체에 적용되는 pod 를 띄울때 사용하는 Controller로 DaemonSet 을 이용해 띄운 pod 는 항상 모든 node 에서 실행된다. 로그 수집이나 모니터링에 적합하다.</li>
</ul>
</li>
<li>StatefulSet
<ul style="list-style-type: circle;" data-indent-level="2" data-ke-list-type="circle">
<li>K8s Object 들은 대부분 Stateless 하다. Stateful 한 Volume 을 이용한 DB 등을 pod 로 만들때 사용하는 Object 이다.</li>
</ul>
</li>
</ul>
<h4 id="4.2-네트워크에-관한-object-들" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="2785" data-ke-size="size20"><b>4.2 네트워크에 관한 object 들</b><span><span data-vc="icon-undefined"></span></span></h4>
<ul style="list-style-type: disc; background-color: #ffffff; color: #172b4d; text-align: start;" data-indent-level="1" data-ke-list-type="disc">
<li>Service&nbsp;
<ul style="list-style-type: disc;" data-ke-list-type="disc">
<li>pod 간 연결 및 pod 와 외부 네트워크를 연결 하는 object 이다.</li>
<li>여러 pod 에 대한 L4 수준의 내부 로드밸런서의 역할을 수행하며 내부 DNS에 서비스를 등록하여 서비스 디스커버리 역할도 수행한다.</li>
</ul>
</li>
</ul>
<p><figure class="imageblock alignCenter" width="420" height="276" >
    <span data-lightbox="lightbox">
        <img src="./img/K8s_Object-Service.png" width="420" height="276"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<ul style="list-style-type: disc; background-color: #ffffff; color: #172b4d; text-align: start;" data-indent-level="1" data-ke-list-type="disc">
<li>Ingress
<ul style="list-style-type: disc;" data-ke-list-type="disc">
<li>외부 트래픽을 받는 Object 로 http, https 등 L7 레벨에서 라우팅 규칙, 로드밸런싱 규칙 등을 설정한다.</li>
<li>일반적으로 클러스터를 외부로 노출할때는 Ingress 를 이용한다.</li>
</ul>
</li>
</ul>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style2" />
<h3 id="5.-최종-K8s-구조" style="background-color: #ffffff; color: #172b4d; text-align: start;" data-renderer-start-pos="3078" data-ke-size="size23">5. 최종 K8s 구조<span><span data-vc="icon-undefined"></span></span></h3>
<p data-ke-size="size16"><span style="background-color: #ffffff; color: #172b4d; text-align: start;">이상의 K8s 구조, Object 를 종합하면 아래와 같이 그릴 수 있습니다.</span></p>
<p><figure class="imageblock alignCenter" width="650" height="276" >
    <span data-lightbox="lightbox">
        <img src="./img/K8s구조-전체.png" width="650" height="276"  />
    </span>
    <figcaption></figcaption>
</figure></p>
                        </div>
                        <br/>
                        <div class="tags">
                            #kubernetes #k8s #msa k8s 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
